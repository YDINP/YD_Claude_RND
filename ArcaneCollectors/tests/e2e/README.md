# ArcaneCollectors E2E í…ŒìŠ¤íŠ¸

Playwrightë¥¼ ì‚¬ìš©í•œ ë¸Œë¼ìš°ì € E2E í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.

## ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Node.js 18 ì´ìƒ
- Playwright ì„¤ì¹˜ ì™„ë£Œ
- ê°œë°œ ì„œë²„ ì‹¤í–‰ ì¤‘ (http://localhost:3002)

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### ê¸°ë³¸ ì‹¤í–‰ (headless)

```bash
node tests/e2e/browser-test.mjs
```

### ì‹œê°ì  í™•ì¸ (headed)

ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ë ¤ë©´:

```bash
node tests/e2e/browser-test.mjs --headed
```

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ë¡œê·¸ì¸ í”Œë¡œìš° (3ê°œ í…ŒìŠ¤íŠ¸)
- âœ… ìº”ë²„ìŠ¤ ì¡´ì¬ í™•ì¸
- âœ… LoginScene í™œì„±í™” í™•ì¸
- âœ… MainMenuScene ì „í™˜ í™•ì¸

### 2. ë©”ì¸ ë©”ë‰´ í™•ì¸ (3ê°œ í…ŒìŠ¤íŠ¸)
- âœ… MainMenuScene í™œì„±í™” ìƒíƒœ
- âœ… IdleBattleView ì¡´ì¬ í™•ì¸
- âœ… ê¸°ë³¸ UI ìš”ì†Œ ì¡´ì¬ í™•ì¸

### 3. íŒì—… í…ŒìŠ¤íŠ¸ (21ê°œ í…ŒìŠ¤íŠ¸)
ê° íŒì—…ì„ ì—´ê³  ë‹«ê¸°:
- âœ… inventory (ì¸ë²¤í† ë¦¬)
- âœ… herolist (ì˜ì›… ëª©ë¡)
- âœ… gacha (ë½‘ê¸°)
- âœ… quest (í€˜ìŠ¤íŠ¸)
- âœ… tower (íƒ€ì›Œ)
- âœ… partyedit (íŒŒí‹° í¸ì§‘)
- âœ… settings (ì„¤ì •)

ê° íŒì—…ë§ˆë‹¤ 3ê°œ í…ŒìŠ¤íŠ¸:
1. íŒì—… ì—´ê¸° ì„±ê³µ
2. íŒì—… ë‹«ê¸° ì„±ê³µ
3. ë©”ì¸ ë©”ë‰´ ë³µê·€ í™•ì¸

### 4. ìë™ì „íˆ¬ ê´€ì°° (4ê°œ í…ŒìŠ¤íŠ¸)
- âœ… ì´ˆê¸° HP ë°” ê°’ í™•ì¸
- âœ… ì „íˆ¬ ì‚¬ì´í´ ì§„í–‰ í™•ì¸
- âœ… HP ë°” ë³€í™” í™•ì¸
- âœ… ì  ìœ ë‹› ì¡´ì¬ í™•ì¸

### 5. ìë™ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ (3ê°œ í…ŒìŠ¤íŠ¸)
- âœ… localStorage arcane_auth ì„¤ì •
- âœ… LoginScene ìŠ¤í‚µ í™•ì¸ (ìë™ ë¡œê·¸ì¸)
- âœ… LoginScene ë¹„í™œì„±í™” í™•ì¸

**ì´ 34ê°œ í…ŒìŠ¤íŠ¸**

## í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
âœ… í†µê³¼: 34
âŒ ì‹¤íŒ¨: 0
ğŸ“Š ì´ í…ŒìŠ¤íŠ¸: 34

ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼!
```

## êµ¬ì¡°

### í•µì‹¬ ìœ í‹¸ë¦¬í‹°

```javascript
// ì¡°ê±´ì´ ì°¸ì´ ë  ë•Œê¹Œì§€ í´ë§ (ìµœëŒ€ timeout ms)
async function waitForCondition(fn, timeout = 10000)

// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ê²€ì¦
function assert(condition, name)
```

### ê²Œì„ ìƒíƒœ ì ‘ê·¼

```javascript
// ì „ì—­ ê²Œì„ ì°¸ì¡°
window.game

// ì”¬ í™œì„±í™” í™•ì¸
window.game.scene.isActive('MainMenuScene')

// ì”¬ ê°€ì ¸ì˜¤ê¸°
window.game.scene.getScene('MainMenuScene')

// íŒì—… ì—´ê¸°/ë‹«ê¸°
scene.openPopup('inventory')
scene.activePopup.close()
```

### localStorage í‚¤

- `arcane_auth`: ìë™ ë¡œê·¸ì¸ ì •ë³´
- `guest_user`: ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë°ì´í„°
- `arcane_collectors_save`: ê²Œì„ ì„¸ì´ë¸Œ ë°ì´í„°

## ì˜¤ë¥˜ ì²˜ë¦¬

í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ `tests/e2e/error.png`ì— ìŠ¤í¬ë¦°ìƒ·ì´ ì €ì¥ë©ë‹ˆë‹¤.

## CI/CD í†µí•©

GitHub Actions ë“±ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´:

```yaml
- name: Install Playwright
  run: npx playwright install --with-deps chromium

- name: Run E2E Tests
  run: node tests/e2e/browser-test.mjs
```

## ì£¼ì˜ì‚¬í•­

- Phaser ê²Œì„ì€ ìº”ë²„ìŠ¤ ê¸°ë°˜ì´ë¯€ë¡œ DOM ì…€ë ‰í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- `page.evaluate()`ë¥¼ í†µí•´ ê²Œì„ ë‚´ë¶€ ìƒíƒœì— ì ‘ê·¼í•©ë‹ˆë‹¤.
- ì”¬ ì „í™˜ê³¼ íŒì—… ì—´ê¸°/ë‹«ê¸°ëŠ” ë¹„ë™ê¸° ë™ì‘ì´ë¯€ë¡œ ì ì ˆí•œ ëŒ€ê¸°ê°€ í•„ìš”í•©ë‹ˆë‹¤.
- í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ê°œë°œ ì„œë²„ê°€ ë°˜ë“œì‹œ ì‹¤í–‰ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

## ê°œë°œ ê°€ì´ë“œ

### ìƒˆ íŒì—… í…ŒìŠ¤íŠ¸ ì¶”ê°€

`popups` ë°°ì—´ì— íŒì—… í‚¤ë¥¼ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë©ë‹ˆë‹¤:

```javascript
const popups = [
  'inventory',
  'herolist',
  'gacha',
  'quest',
  'tower',
  'partyedit',
  'settings',
  'newpopup' // ìƒˆ íŒì—… ì¶”ê°€
];
```

### ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€

```javascript
console.log('\n=== 6. ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ===\n');

// í…ŒìŠ¤íŠ¸ ì½”ë“œ...
const result = await page.evaluate(() => {
  // ê²Œì„ ìƒíƒœ í™•ì¸ ë¡œì§
});

assert(result, 'í…ŒìŠ¤íŠ¸ ì„¤ëª…');
```
