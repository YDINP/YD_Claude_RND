# Arcane Collectors v4 - 대규모 시스템 개편 PRD

## 1. 개요

### 1.1 문서 정보
- 버전: 4.0
- 작성일: 2025-01-27
- 목적: 핵심 시스템 개편 및 백엔드 구축

### 1.2 현재 상태 (v3)
- 5인 파티 시스템
- Fire/Water/Wind/Light/Dark 속성
- LocalStorage 저장
- 480x854 해상도

### 1.3 v4 목표
1. 파티 5인 → 4인 변경
2. 속성 → "성격(Personality)" 특성으로 변경
3. 시너지 시스템 전면 개편
4. Supabase 백엔드 구현 (최우선)
5. 해상도 향상 (720x1280, 1080x1920 지원)
6. 소탕 기능, 에너지 시스템 추가

---

## 2. 핵심 변경사항

### 2.1 파티 시스템 (5인 → 4인)
- 전투 유닛: 최대 4명
- 파티 편성 저장/불러오기
- 슬롯 1개 감소로 전략적 선택 강화

### 2.2 성격(Personality) 특성 시스템

**기존 속성 제거**: Fire, Water, Wind, Light, Dark

**새로운 성격 5종**:

| 성격 | 이름 | 설명 | 테마 색상 |
|-----|------|-----|----------|
| **Brave** | 용감 | 정면 돌파, 높은 공격력 | #E74C3C (빨강) |
| **Cunning** | 교활 | 전략적, 크리티컬 특화 | #9B59B6 (보라) |
| **Calm** | 냉정 | 분석적, 방어/회복 특화 | #3498DB (파랑) |
| **Wild** | 야성 | 본능적, 속도/연속 공격 | #27AE60 (초록) |
| **Mystic** | 신비 | 초월적, 특수 효과 특화 | #F39C12 (황금) |

### 2.3 성격 상호작용 (상성 대체)

| 공격자 | 유리 대상 | 불리 대상 | 효과 |
|-------|----------|----------|------|
| Brave | Cunning | Calm | +20% / -20% |
| Cunning | Calm | Wild | +20% / -20% |
| Calm | Wild | Brave | +20% / -20% |
| Wild | Brave | Cunning | +20% / -20% |
| Mystic | 모든 성격 | - | +10% (고정) |

### 2.4 성격-교단 보너스

| 교단 | 최적 성격 | 보너스 |
|-----|---------|-------|
| 발할라 | Brave, Wild | ATK +15% |
| 타카마가하라 | Cunning, Mystic | CRIT +10% |
| 올림푸스 | Brave, Mystic | 스킬 데미지 +15% |
| 아스가르드 | Calm, Wild | HP/DEF +15% |
| 요미 | Cunning, Calm | 디버프 효과 +20% |

---

## 3. 시너지 시스템 개편

### 3.1 교단 시너지 (유지)

| 동일 교단 | 효과 |
|----------|------|
| 2명 | ATK +10% |
| 3명 | ATK +15%, DEF +10% |
| 4명 (풀파티) | 모든 스탯 +20% |

### 3.2 성격 시너지 (신규)

| 조합 | 효과 |
|-----|------|
| Brave + Wild | "전사의 분노" - ATK +20%, DEF -10% |
| Cunning + Calm | "냉철한 계산" - CRIT +15%, 스킬 쿨다운 -1 |
| Mystic + Any | "신비의 가호" - 특수 효과 발동률 +10% |
| All Different | "균형의 힘" - 모든 스탯 +10% |

### 3.3 특수 시너지 (확장)

| 이름 | 조합 | 효과 |
|-----|------|------|
| 북유럽의 황혼 | 오딘 + 토르 + 로키 | ATK/DEF +25% |
| 일본 삼종신기 | 아마테라스 + 스사노오 + 츠쿠요미 | 스킬 데미지 +30% |
| 올림푸스 삼신 | 제우스 + 포세이돈 + 하데스 | 전체 스탯 +20% |
| 발키리 자매단 | 발키리 3명 | 부활 확률 30% |
| 요괴 대전 | 텐구 + 오니 + 카파 | 적 디버프 +25% |
| 북유럽 사형제 | 오딘 + 토르 + 로키 + 프레야 | 궁극 버프 |
| 일출과 일몰 | 아마테라스 + 츠쿠요미 | 빛/어둠 데미지 면역 |
| 전쟁의 여신들 | 프레야 + 아테나 | 여성 유닛 ATK +15% |
| 뇌신 동맹 | 토르 + 제우스 | 번개 추가 데미지 |
| 저승의 지배자 | 하데스 + 이자나미 | 즉사 확률 5% |

---

## 4. 백엔드 시스템 (Supabase)

### 4.1 데이터베이스 스키마

**users 테이블**:
```sql
- id: uuid (PK)
- email: text
- nickname: text
- created_at: timestamp
- last_login: timestamp
```

**player_data 테이블**:
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- gold: integer
- gems: integer
- energy: integer
- max_energy: integer
- player_level: integer
- exp: integer
- vip_level: integer
```

**heroes 테이블**:
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- hero_id: text
- level: integer
- exp: integer
- stars: integer (진화 단계)
- skill_levels: jsonb
- equipment: jsonb
```

**parties 테이블**:
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- slot_number: integer (1-5)
- hero_ids: text[] (4개)
- is_active: boolean
```

**stage_progress 테이블**:
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- stage_id: text
- stars: integer (0-3)
- clear_count: integer
- best_time: integer
```

**inventory 테이블**:
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- item_id: text
- quantity: integer
```

### 4.2 API 엔드포인트

| 메서드 | 경로 | 설명 |
|-------|-----|------|
| POST | /auth/register | 회원가입 |
| POST | /auth/login | 로그인 |
| GET | /player/data | 플레이어 데이터 조회 |
| PUT | /player/data | 플레이어 데이터 저장 |
| GET | /heroes | 보유 영웅 목록 |
| POST | /gacha/pull | 가챠 실행 |
| POST | /battle/start | 전투 시작 |
| POST | /battle/result | 전투 결과 저장 |
| POST | /sweep | 소탕 실행 |

---

## 5. UI/UX 개편

### 5.1 해상도 향상

| 구분 | 기존 | 변경 |
|-----|-----|------|
| 기본 | 480x854 | 720x1280 |
| HD | - | 1080x1920 |
| 스케일링 | 고정 | 반응형 |

### 5.2 하단 메뉴 탭 (고정)

```
┌─────────────────────────────────────┐
│         [게임 콘텐츠 영역]           │
│                                     │
│                                     │
├─────────────────────────────────────┤
│  🏠     ⚔️      📦      🎲      ≡   │
│  홈    모험    가방    소환    더보기 │
└─────────────────────────────────────┘
```

### 5.3 메인화면 메뉴 구성

**상단 영역**:
- 플레이어 정보 (레벨, 닉네임)
- 재화 표시 (골드, 보석, 에너지)
- 알림/메일 아이콘

**중앙 영역**:
- 메인 캐릭터 표시 (터치 반응)
- 파티 미니 표시

**퀵 메뉴**:
- 일일 퀘스트
- 이벤트 배너
- 상점 바로가기

**하단 탭 (고정)**:
1. 홈 - 메인화면
2. 모험 - 스테이지 선택
3. 가방 - 인벤토리/영웅
4. 소환 - 가챠
5. 더보기 - 설정/상점/커뮤니티

### 5.4 모험 결과 화면

```
┌─────────────────────────────────────┐
│         ⭐⭐⭐ 승리! ⭐⭐⭐          │
├─────────────────────────────────────┤
│  획득 보상:                          │
│  🪙 1,500 골드                       │
│  ✨ 300 경험치                       │
│  📦 진화 재료 x2                     │
├─────────────────────────────────────┤
│  [다시하기]  [다음 스테이지]  [홈]   │
└─────────────────────────────────────┘
```

---

## 6. 게임플레이 확장

### 6.1 에너지 시스템

| 항목 | 값 |
|-----|---|
| 최대 에너지 | 100 + (레벨 × 2) |
| 회복 속도 | 5분당 1 |
| 레벨업 시 | 전량 회복 |
| 보석 충전 | 50보석 = 50에너지 |

**스테이지별 소모**:
- 일반: 6 에너지
- 엘리트: 12 에너지
- 보스: 20 에너지

### 6.2 소탕 기능

**조건**: 별 3개 클리어 완료
**비용**: 에너지 + 소탕권 1장
**결과**: 즉시 보상 획득 (전투 스킵)
**제한**: 일일 50회

### 6.3 모험 확장

**기존**: 3챕터 12스테이지
**확장**: 5챕터 25스테이지

| 챕터 | 이름 | 스테이지 | 권장 전투력 |
|-----|------|---------|-----------|
| 1 | 균열의 시작 | 5 | 100~500 |
| 2 | 신들의 전장 | 5 | 600~1,500 |
| 3 | 요미의 심연 | 5 | 1,800~3,500 |
| 4 | 올림푸스의 시련 | 5 | 4,000~7,000 |
| 5 | 라그나로크 | 5 | 8,000~15,000 |

**난이도 완화 (초반)**:
- 1챕터 적 HP/ATK -20%
- 튜토리얼 보상 증가

---

## 7. 장비/아이템 확장

### 7.1 장비 등급별 개수

| 등급 | 무기 | 방어구 | 악세서리 | 유물 | 합계 |
|-----|-----|-------|---------|-----|-----|
| N | 5 | 5 | 5 | 3 | 18 |
| R | 5 | 5 | 5 | 4 | 19 |
| SR | 5 | 5 | 5 | 5 | 20 |
| SSR | 6 | 6 | 6 | 6 | 24 |
| **총합** | 21 | 21 | 21 | 18 | **81개** |

### 7.2 소비 아이템

| 종류 | 용도 |
|-----|------|
| 경험치 포션 (소/중/대) | 영웅 경험치 |
| 강화석 (일반/고급/최상급) | 장비 강화 |
| 진화 재료 (R/SR/SSR) | 영웅 진화 |
| 스킬북 (일반/고급) | 스킬 레벨업 |
| 소탕권 | 소탕 사용 |
| 에너지 포션 | 에너지 회복 |

---

## 8. 파티 편성 시스템

### 8.1 파티 슬롯
- 최대 5개 파티 저장 가능
- 각 파티 4명 구성
- 활성 파티 1개 지정

### 8.2 파티 저장/불러오기
- 서버에 자동 저장
- 모험 선택 시 파티 선택 가능
- 모험 결과 후 파티 유지

---

## 9. 성공 지표

| 지표 | 목표 |
|-----|------|
| Supabase 연동 | 완료 |
| 빌드 성공 | ✓ |
| 모든 기능 동작 | ✓ |
| 해상도 대응 | 720p/1080p |

---

## 10. 리스크 대응

| 리스크 | 영향 | 대응 |
|-------|-----|------|
| 기존 저장 데이터 | 높음 | 마이그레이션 스크립트 |
| Supabase 비용 | 중간 | Free tier 활용 |
| 복잡도 증가 | 중간 | 모듈화, 문서화 |
