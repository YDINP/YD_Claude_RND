# SubwayMate PRD v2 - Task 기반 개발 문서

## 개발 플로우 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                    개발 플로우 다이어그램                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [메인 Claude] ──────────────────────────────────────────────►  │
│       │                                                         │
│       │ 1. 기능 개발                                            │
│       ▼                                                         │
│  ┌─────────────┐                                                │
│  │ 코드 작성    │                                                │
│  └──────┬──────┘                                                │
│         │                                                       │
│         │ 2. 코드 검증 요청                                      │
│         ▼                                                       │
│  ┌─────────────────────────────────────────┐                   │
│  │ [코드검증 에이전트]                       │                   │
│  │  - 문법 검사                              │                   │
│  │  - 아키텍처 검증                          │                   │
│  │  - 의존성 확인                            │                   │
│  │  - 빌드 테스트                            │                   │
│  └──────┬──────────────────────────────────┘                   │
│         │                                                       │
│         │ 3. 검증 완료 후 테스트 요청                            │
│         ▼                                                       │
│  ┌─────────────────────────────────────────┐                   │
│  │ [테스트 에이전트]                         │                   │
│  │  - 테스트 코드 작성                       │                   │
│  │  - ADB 테스트 실행                        │                   │
│  │  - 기능 검증                              │                   │
│  │  - 버그 리포트                            │                   │
│  └──────┬──────────────────────────────────┘                   │
│         │                                                       │
│         │ 4. 결과 보고                                          │
│         ▼                                                       │
│  [메인 Claude] ◄────────────────────────────────────────────── │
│       │                                                         │
│       │ 5. 다음 Task 진행 또는 버그 수정                         │
│       ▼                                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 현재 버전 상태

- **버전**: v1.0-beta
- **마지막 빌드**: 성공
- **주요 완료 기능**:
  - 역/노선 선택
  - 실시간 추적 화면
  - 도착 알림
  - 즐겨찾기/최근경로
  - Foreground Service
  - Toast → Android 알림 변환

---

## Task 목록

### Phase 1: 핵심 UX 개선

#### TASK-001: 고정 알림에 현재 위치 표시
- **상태**: 🔴 대기
- **우선순위**: HIGH
- **담당**: 메인 Claude
- **의존성**: 없음

**설명**:
Foreground Service 알림에 현재 역 이름을 표시하여 사용자가 알림창에서 현재 위치를 확인할 수 있도록 함.

**변경 파일**:
- `ServiceNotificationManager.kt` - 현재 역 표시 로직 추가
- `TrackingService.kt` - 현재 역 정보 전달
- `strings.xml` - 알림 문자열 추가

**수락 기준**:
- [ ] 알림에 "현재: [역이름]" 형태로 현재 역 표시
- [ ] 역 이동 시 실시간 업데이트
- [ ] 남은 역 수와 함께 표시

**테스트 시나리오**:
```bash
# 테스트 모드로 추적 시작
adb shell am start -n com.ydinp.subwaymate.debug/com.ydinp.subwaymate.presentation.MainActivity \
  --es debug_navigate_to tracking --ez debug_auto_test true \
  --es departure_id "214" --es arrival_id "222" --es line_id "line2" --es direction "UP"

# 알림창 확인
adb shell dumpsys notification | grep -A 5 "SubwayMate"
```

---

#### TASK-002: 메인화면 UX 변경 - 경로 먼저 선택
- **상태**: 🔴 대기
- **우선순위**: HIGH
- **담당**: 메인 Claude
- **의존성**: 없음

**설명**:
메인화면에서 호선/방향을 먼저 선택하지 않고, 출발역/도착역을 먼저 선택한 후 자동으로 호선과 방향을 결정하도록 UX 변경.

**현재 플로우**:
```
1. 호선 선택
2. 방향 선택
3. 출발역 선택
4. 도착역 선택
5. 추적 시작
```

**변경 후 플로우**:
```
1. 출발역 선택 (전체 역 검색)
2. 도착역 선택 (같은 노선 역만 필터)
3. 호선/방향 자동 결정 (또는 환승 시 선택)
4. 추적 시작
```

**변경 파일**:
- `MainScreen.kt` - UI 순서 변경
- `MainViewModel.kt` - 로직 변경
- `StationSelectScreen.kt` - 전체 역 검색 지원

**수락 기준**:
- [ ] 호선 선택 없이 출발역 선택 가능
- [ ] 출발역 선택 후 동일 노선 역만 도착역으로 표시
- [ ] 호선/방향 자동 결정
- [ ] 환승 경로는 향후 지원 (v2)

---

### Phase 2: 알림 시스템 고도화

#### TASK-003: 도착 N역 전 알림 커스터마이징
- **상태**: 🔴 대기
- **우선순위**: MEDIUM
- **담당**: 메인 Claude
- **의존성**: TASK-001

**설명**:
사용자가 도착 알림을 받을 역 수를 설정할 수 있도록 함 (기본값: 1역 전).

**변경 파일**:
- `AlertSetting.kt` - 설정 모델
- `TrackingViewModel.kt` - 알림 로직
- `AlertSettingBottomSheet.kt` - UI

---

#### TASK-004: 특정 역 알림 기능
- **상태**: ✅ 완료
- **우선순위**: MEDIUM

**설명**:
도착역 외에 특정 역(환승역 등)에서도 알림을 받을 수 있도록 함.

---

### Phase 3: 테스트 인프라

#### TASK-005: ADB 테스트 명령어 문서화
- **상태**: 🔴 대기
- **우선순위**: LOW
- **담당**: 테스트 에이전트

**테스트 명령어 목록**:
```bash
# 1. 테스트 모드 추적 시작
adb shell am start -n com.ydinp.subwaymate.debug/com.ydinp.subwaymate.presentation.MainActivity \
  --es debug_navigate_to tracking --ez debug_auto_test true \
  --es departure_id "[출발역ID]" --es arrival_id "[도착역ID]" \
  --es line_id "[노선ID]" --es direction "[UP/DOWN]"

# 2. 앱 로그 확인
adb logcat -s TrackingViewModel TrackingScreen ServiceNotificationManager

# 3. 알림 상태 확인
adb shell dumpsys notification | grep -A 10 "subwaymate"

# 4. 앱 강제 종료
adb shell am force-stop com.ydinp.subwaymate

# 5. APK 설치
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

---

## 역 데이터 참조

### 2호선 주요 역 ID
| 역이름 | ID | sequence |
|--------|-----|----------|
| 강변 | 214 | 14 |
| 잠실나루 | 215 | 15 |
| 잠실 | 216 | 16 |
| 잠실새내 | 217 | 17 |
| 종합운동장 | 218 | 18 |
| 삼성 | 219 | 19 |
| 선릉 | 220 | 20 |
| 역삼 | 221 | 21 |
| 강남 | 222 | 22 |

---

## 에이전트 역할 정의

### 메인 Claude (개발)
- 기능 설계 및 구현
- 코드 작성
- 아키텍처 결정
- PRD 업데이트

### 코드검증 에이전트
- 빌드 테스트 실행
- 문법 오류 검사
- 의존성 확인
- 아키텍처 패턴 검증

### 테스트 에이전트
- ADB 명령어로 기능 테스트
- 테스트 시나리오 실행
- 버그 리포트 작성
- 테스트 커버리지 확인

---

## 다음 단계

1. **TASK-001** 진행: 고정 알림에 현재 위치 표시
2. **TASK-002** 진행: 메인화면 UX 변경
3. 코드검증 에이전트로 빌드 확인
4. 테스트 에이전트로 기능 테스트
