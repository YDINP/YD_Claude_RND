# PRD: 탑승 중 상단 고정 알림 기능

## 1. 기능 개요

### 1.1 기능명
**Persistent Tracking Notification** - 탑승 중 상단 고정 알림

### 1.2 기능 목적
사용자가 지하철 탑승 중일 때 앱을 열지 않고도 상단 알림바에서 현재 위치와 남은 역 수를 실시간으로 확인할 수 있도록 합니다.

### 1.3 사용 시나리오
1. 사용자가 열차를 선택하여 탑승 시작
2. 앱이 백그라운드로 전환되어도 상단에 고정 알림 표시
3. 알림에서 현재 역, 남은 역 수, 도착역 정보 실시간 업데이트
4. 도착역에 도착하면 알림 종료 또는 도착 알림으로 전환

---

## 2. 상세 요구사항

### 2.1 알림 표시 조건
- **시작**: 열차 선택 후 탑승 시작 시 (IN_TRANSIT 상태)
- **종료**: 도착역 도착 또는 사용자가 추적 종료 시

### 2.2 알림 UI 구성
```
┌─────────────────────────────────────────────┐
│ 🚇 SubwayMate                        진행중 │
│ ───────────────────────────────────────────│
│ 현재: 강남역 → 도착: 신림역                │
│ 남은 역: 5개 | 예상 도착: 약 10분          │
│                                             │
│ [추적 중단]                                 │
└─────────────────────────────────────────────┘
```

### 2.3 알림 내용
| 항목 | 설명 | 업데이트 주기 |
|------|------|---------------|
| 현재 역 | 현재 위치한 역 또는 마지막 출발역 | 실시간 (10초) |
| 도착역 | 설정한 목적지 역 | 고정 |
| 남은 역 수 | 도착역까지 남은 역 개수 | 실시간 |
| 예상 도착 시간 | 예상 소요 시간 | 실시간 |
| 진행률 | 전체 경로 대비 진행률 | 실시간 |

### 2.4 알림 동작
- **Ongoing Notification**: 사용자가 스와이프로 제거 불가
- **탭 시**: 앱의 추적 화면으로 이동
- **버튼**: "추적 중단" 버튼으로 추적 종료 가능

### 2.5 알림 채널
- 채널 ID: `tracking_status`
- 채널명: "탑승 추적 상태"
- 중요도: Low (무음, 진동 없음)
- 잠금화면 표시: 예

---

## 3. 기술 요구사항

### 3.1 Foreground Service
- 탑승 추적 시 Foreground Service 사용
- 배터리 최적화에서 제외되어 백그라운드에서도 동작

### 3.2 알림 업데이트
- NotificationCompat.Builder 사용
- 동일 ID로 notify() 호출하여 내용 업데이트
- 너무 잦은 업데이트 방지 (최소 5초 간격)

### 3.3 관련 파일
- `TrackingService.kt` - Foreground Service
- `ServiceNotificationManager.kt` - 알림 관리
- `TrackingViewModel.kt` - 상태 업데이트

---

## 4. 구현 우선순위

### Phase 1: 기본 구현
1. Foreground Service 생성
2. 기본 고정 알림 표시
3. 현재 역, 남은 역 수 표시

### Phase 2: 고도화
1. 진행률 바 추가
2. 예상 도착 시간 표시
3. 알림 액션 버튼 (추적 중단)

### Phase 3: UX 개선
1. 알림 디자인 커스터마이징
2. 도착 임박 시 알림 스타일 변경
3. 잠금화면 위젯 지원

---

## 5. 성공 지표
- 알림이 정상적으로 상단에 고정되어 표시됨
- 역 이동 시 실시간으로 정보가 업데이트됨
- 앱이 백그라운드에 있어도 알림이 유지됨
- 배터리 소모가 과도하지 않음 (기존 대비 +5% 이내)
