# PRD: 한국 지하철 실시간 도착 알림 앱

## 1. 제품 개요

### 1.1 제품명
**SubwayMate (가칭)** - 수도권 지하철 실시간 위치 기반 도착 알림 서비스

### 1.2 제품 비전
사용자가 지하철에 탑승한 순간부터 목적지 도착까지, 실시간 위치 추적을 통해 정확한 시점에 알림을 제공하여 환승이나 하차를 놓치지 않도록 돕는 스마트 지하철 도우미

### 1.3 타겟 사용자
- 출퇴근 시 지하철을 이용하는 직장인
- 지하철 이용이 익숙하지 않은 관광객/외지인
- 이동 중 다른 활동(독서, 영상 시청, 수면 등)을 하는 승객
- 환승이 많은 복잡한 경로를 이용하는 승객

---

## 2. 문제 정의

### 2.1 현재 문제점
1. **하차역 놓침**: 스마트폰 사용, 졸음 등으로 목적지 하차를 놓치는 경우 빈번
2. **위치 파악 어려움**: 지하에서는 GPS가 작동하지 않아 현재 위치 파악이 어려움
3. **기존 앱의 한계**: 대부분의 지하철 앱은 역 도착 시간만 제공하고, 탑승 후 실시간 추적은 미지원
4. **환승 타이밍**: 복잡한 환승역에서 적절한 하차 타이밍을 놓침

### 2.2 해결 방안
- 열차 운행 스케줄 + 탑승 시간 기반 실시간 위치 추정
- 사용자 설정 도착역 기준 N분/N역 전 알림
- 실시간 열차 위치 API 연동으로 정확도 향상

---

## 3. 핵심 기능 (MVP)

### 3.1 Phase 1 - MVP (핵심 알림 기능)

#### 3.1.1 탑승 시작
- [ ] 출발역 선택 (역 검색, 최근 이용역, GPS 기반 추천)
- [ ] 탑승 호선 및 방향 선택
- [ ] 도착역 설정

#### 3.1.2 실시간 위치 추적
- [ ] 현재 위치 표시 (역 또는 역 간 이동 중)
- [ ] 남은 역 수 및 예상 도착 시간 표시
- [ ] 실시간 열차 위치 API 연동 (서울 열린데이터광장)

#### 3.1.3 도착 알림
- [ ] N역 전 알림 설정 (기본값: 1역 전)
- [ ] N분 전 알림 설정
- [ ] 푸시 알림 + 진동 + 소리 옵션
- [ ] 알림 반복 설정 (1회/도착까지 반복)

#### 3.1.4 노선도 UI
- [ ] 현재 탑승 노선 시각화
- [ ] 현재 위치 하이라이트
- [ ] 도착역 표시

### 3.2 Phase 2 - 확장 기능

#### 3.2.1 경로 검색/추천
- [ ] 출발역-도착역 최적 경로 검색
- [ ] 최소 환승 / 최단 시간 옵션
- [ ] 환승 안내 (환승역, 방향, 소요시간)
- [ ] ODsay API 연동

#### 3.2.2 즐겨찾기/자주가는 경로
- [ ] 자주 이용하는 역 즐겨찾기
- [ ] 자주 이용하는 경로 저장
- [ ] 원터치 알림 설정 (저장된 경로 바로 시작)
- [ ] 이용 패턴 분석 및 추천

#### 3.2.3 역 간 위치 추적 고도화
- [ ] 가속도계 센서 활용 이동 감지
- [ ] 역 정차 감지 (속도 변화 패턴)
- [ ] WiFi/셀룰러 기반 위치 보정

---

## 4. 기술 스택

### 4.1 클라이언트 (Android)
```
- 언어: Kotlin
- 최소 SDK: API 26 (Android 8.0)
- 아키텍처: MVVM + Clean Architecture
- UI: Jetpack Compose
- DI: Hilt
- 네트워크: Retrofit2 + OkHttp
- 비동기: Kotlin Coroutines + Flow
- 로컬 DB: Room
- 알림: FCM + WorkManager (백그라운드)
```

### 4.2 백엔드 (선택적)
```
- 런타임: Node.js 또는 Python FastAPI
- 역할: API 캐싱, 데이터 정제, 푸시 알림 관리
- DB: PostgreSQL + Redis (캐시)
- 호스팅: AWS / GCP / Vercel
```

### 4.3 외부 API
| API | 용도 | 비용 |
|-----|------|------|
| 서울 열린데이터광장 - 실시간 열차 위치 | 열차 실시간 위치 | 무료 (1,000건/일) |
| 서울 열린데이터광장 - 실시간 도착정보 | 역별 도착 예정 시간 | 무료 (1,000건/일) |
| 공공데이터포털 - 지하철역 정보 | 역 정보, 노선 정보 | 무료 |
| ODsay Lab API | 경로 검색 (Phase 2) | 기본 무료 |
| KRIC 레일포털 | 전국 철도 정보 | 무료 (무제한) |

---

## 5. 데이터 모델

### 5.1 핵심 엔티티
```kotlin
// 역 정보
data class Station(
    val id: String,
    val name: String,
    val line: Line,
    val latitude: Double,
    val longitude: Double,
    val transferLines: List<Line>
)

// 노선 정보
data class Line(
    val id: String,
    val name: String,        // "2호선"
    val color: String,       // "#00A84D"
    val stations: List<Station>
)

// 탑승 세션
data class RideSession(
    val id: String,
    val departureStation: Station,
    val destinationStation: Station,
    val line: Line,
    val direction: Direction,    // 상행/하행
    val startTime: LocalDateTime,
    val currentStation: Station?,
    val status: RideStatus       // BOARDING, IN_TRANSIT, ARRIVED
)

// 알림 설정
data class AlertSetting(
    val stationsBefore: Int,     // N역 전
    val minutesBefore: Int?,     // N분 전 (선택)
    val soundEnabled: Boolean,
    val vibrationEnabled: Boolean,
    val repeatUntilArrival: Boolean
)
```

---

## 6. 화면 설계 (와이어프레임)

### 6.1 메인 화면
```
┌─────────────────────────────┐
│  SubwayMate                 │
├─────────────────────────────┤
│                             │
│  ┌─────────────────────┐    │
│  │ 출발역 선택          │    │
│  └─────────────────────┘    │
│                             │
│  ┌─────────────────────┐    │
│  │ 도착역 선택          │    │
│  └─────────────────────┘    │
│                             │
│  ┌─────────────────────┐    │
│  │ 호선/방향 선택       │    │
│  └─────────────────────┘    │
│                             │
│  ┌─────────────────────────┐│
│  │      [알림 시작]        ││
│  └─────────────────────────┘│
│                             │
│  ─────── 즐겨찾기 ───────   │
│  집 -> 회사 (2호선)         │
│  회사 -> 집 (2호선)         │
└─────────────────────────────┘
```

### 6.2 실시간 추적 화면
```
┌─────────────────────────────┐
│  <- 2호선 외선 방향         │
├─────────────────────────────┤
│                             │
│   ○ 강남 (출발)             │
│   │                         │
│   ◉ 역삼 <- 현재 위치       │
│   │                         │
│   ○ 선릉                    │
│   │                         │
│   ○ 삼성                    │
│   │                         │
│   ● 종합운동장 (도착)       │
│                             │
├─────────────────────────────┤
│  남은 역: 3역               │
│  예상 도착: 약 6분          │
│                             │
│  알림: 1역 전 | 소리 ON     │
└─────────────────────────────┘
```

---

## 7. 실시간 위치 추적 알고리즘

### 7.1 위치 추정 방식
```
1. 초기 위치 설정
   - 사용자가 출발역 선택 시 해당 역을 현재 위치로 설정

2. 실시간 API 연동
   - 서울 열린데이터광장 "실시간 열차 위치 API" 폴링 (30초 간격)
   - 사용자 탑승 열차 식별 (출발역 + 시간 + 방향 매칭)

3. 위치 업데이트
   - API 응답의 열차 위치 정보로 현재 역 업데이트
   - 역 간 이동 중일 경우 "역삼 -> 선릉 이동 중" 표시

4. 알림 트리거
   - 현재 위치가 도착역 N역 전에 도달 시 알림 발송
   - 백그라운드 서비스로 앱 종료 후에도 동작
```

### 7.2 오프라인 폴백
```
- API 연결 실패 시 평균 역간 소요시간 기반 추정
- 각 노선별 역간 평균 소요시간 데이터 내장
- 탑승 시작 시간 + 경과 시간으로 현재 위치 계산
```

---

## 8. 지원 노선 (MVP)

### 수도권 지하철
| 노선 | 구간 | 비고 |
|------|------|------|
| 1호선 | 소요산 - 인천/신창 | 경인선, 경부선 포함 |
| 2호선 | 순환 + 성수지선 + 신정지선 | |
| 3호선 | 대화 - 오금 | |
| 4호선 | 당고개 - 오이도 | |
| 5호선 | 방화 - 마천/하남검단산 | |
| 6호선 | 응암순환 - 신내 | |
| 7호선 | 장암 - 청라국제도시 | |
| 8호선 | 암사 - 모란 | |
| 9호선 | 개화 - 중앙보훈병원 | |
| 경의중앙선 | 문산 - 지평 | |
| 경춘선 | 청량리 - 춘천 | |
| 수인분당선 | 청량리 - 인천 | |
| 신분당선 | 신사 - 광교 | |
| 공항철도 | 서울역 - 인천공항 | |
| GTX-A | 수서 - 동탄 | |

---

## 9. 성공 지표 (KPI)

### 9.1 사용자 지표
- DAU (일일 활성 사용자)
- 평균 세션 시간
- 알림 설정 완료율
- 재사용률 (7일 이내 재방문)

### 9.2 기능 지표
- 알림 정확도 (실제 도착 vs 알림 시점)
- 위치 추적 정확도
- API 응답 성공률

### 9.3 MVP 목표
- 알림 정확도 95% 이상 (+-1역 오차)
- 앱 크래시율 1% 미만
- 평균 배터리 소모 5% 미만 (1시간 사용 기준)

---

## 10. 리스크 및 대응

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| API 호출 제한 (1,000건/일) | 높음 | 백엔드 캐싱 레이어 구축, 스마트 폴링 |
| 지하 통신 불안정 | 중간 | 오프라인 폴백 알고리즘, 로컬 데이터 활용 |
| 열차 지연/사고 | 중간 | 실시간 운행 정보 연동, 지연 알림 |
| 배터리 소모 | 중간 | 효율적인 백그라운드 처리, Doze 모드 대응 |
| 서울 외 지역 데이터 미제공 | 낮음 | KRIC API로 보완, 점진적 확장 |

---

## 11. 개발 로드맵

### Phase 1: MVP (핵심 기능)
- 프로젝트 셋업 및 아키텍처 구성
- 역/노선 데이터 구축
- 탑승 시작 플로우 구현
- 실시간 위치 추적 구현
- 도착 알림 기능 구현
- 기본 UI 구현

### Phase 2: 확장 기능
- 경로 검색 기능 (ODsay API)
- 즐겨찾기 기능
- 사용자 설정 고도화
- UI/UX 개선

### Phase 3: 고도화
- 센서 기반 위치 보정
- 혼잡도 정보 연동
- 위젯 지원
- iOS 버전 개발

---

## 12. 검증 계획

### 12.1 기능 테스트
- [ ] 실제 지하철 탑승 테스트 (2호선 전 구간)
- [ ] 알림 정확도 측정 (10회 이상)
- [ ] 백그라운드 동작 테스트
- [ ] 오프라인 모드 테스트

### 12.2 API 테스트
- [ ] 서울 열린데이터광장 API 연동 테스트
- [ ] API 응답 지연/실패 시나리오 테스트
- [ ] 일일 호출 제한 도달 시 동작 테스트

### 12.3 성능 테스트
- [ ] 배터리 소모량 측정
- [ ] 메모리 사용량 측정
- [ ] 앱 시작 시간 측정
