{
  "name": "Spine Atlas Generator",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "generate-character",
        "responseMode": "responseNode"
      },
      "id": "webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        250,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "const input = \\.first().json.body || \\.first().json;\nconst char = input.character_name || 'arcana';\nconst exprs = input.expressions || ['idle'];\nconst base_pos = 'score_9, score_8_up, source_anime, masterpiece, chibi, 2.5 head ratio, cute, full body, solid white background, game character, korean gacha style';\nconst base_neg = 'realistic, photorealistic, 3d, lowres, bad anatomy, worst quality, complex background';\nconst chars = {arcana: '1girl, purple twintails, witch hat, purple dress', leonhardt: '1boy, blonde, knight armor', selene: '1girl, silver hair, archer'};\nconst expr_prompts = {idle: 'relaxed pose', happy: 'happy smile', skill: 'action pose, magic aura'};\nreturn exprs.map(e => ({json: {character: char, expression: e, positive: base_pos+', '+(chars[char]||chars.arcana)+', '+(expr_prompts[e]||''), negative: base_neg, filename: char+'_'+e, seed: Math.floor(Math.random()*4294967295)}}));"
      },
      "id": "code",
      "name": "Prepare",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        450,
        300
      ]
    },
    {
      "parameters": {
        "batchSize": 1
      },
      "id": "batch",
      "name": "Batch",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        650,
        300
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:8188/prompt",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({prompt:{'3':{inputs:{seed:\\.seed,steps:30,cfg:7,sampler_name:'dpmpp_2m',scheduler:'karras',denoise:1,model:['4',0],positive:['6',0],negative:['7',0],latent_image:['5',0]},class_type:'KSampler'},'4':{inputs:{ckpt_name:'ponyDiffusionV6XL.safetensors'},class_type:'CheckpointLoaderSimple'},'5':{inputs:{width:1024,height:1024,batch_size:1},class_type:'EmptyLatentImage'},'6':{inputs:{text:\\.positive,clip:['4',1]},class_type:'CLIPTextEncode'},'7':{inputs:{text:\\.negative,clip:['4',1]},class_type:'CLIPTextEncode'},'8':{inputs:{samples:['3',0],vae:['4',2]},class_type:'VAEDecode'},'10':{inputs:{image:['8',0]},class_type:'Image Remove Background (rembg)'},'9':{inputs:{filename_prefix:\\.filename,images:['10',0]},class_type:'SaveImage'}},client_id:'n8n'}) }}"
      },
      "id": "comfy",
      "name": "ComfyUI",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        850,
        300
      ]
    },
    {
      "parameters": {
        "amount": 30,
        "unit": "seconds"
      },
      "id": "wait",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1050,
        300
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\"status\":\"success\",\"message\":\"Generation complete\"}"
      },
      "id": "respond",
      "name": "Done",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1250,
        300
      ]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Prepare",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare": {
      "main": [
        [
          {
            "node": "Batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Batch": {
      "main": [
        [
          {
            "node": "ComfyUI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Done",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ComfyUI": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Batch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}